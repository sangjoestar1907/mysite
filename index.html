<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Saki Hub - Blox Fruits Event Tracker</title>
  <link rel="icon" type="image/png" href="logo.png">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    :root {
      --primary-color: #feca57;
      --secondary-color: #ff6b6b;
      --dark-bg: #0c0c0c;
      --medium-bg: #1a1a2e;
      --light-bg: #16213e;
      --card-bg: rgba(255, 255, 255, 0.05);
      --border-color: rgba(255, 255, 255, 0.1);
      --success-color: #4CAF50;
      --error-color: #f44336;
      --text-color: #fff;
      --text-muted: #888;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, var(--dark-bg) 0%, var(--medium-bg) 50%, var(--light-bg) 100%);
      color: var(--text-color);
      min-height: 100vh;
      overflow-x: hidden;
      line-height: 1.6;
    }

    /* Header */
    header {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 15px 0;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(10px);
      position: sticky;
      top: 0;
      z-index: 1000;
      border-bottom: 1px solid var(--border-color);
    }

    .logo {
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
      color: var(--text-color);
      padding: 8px 16px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 12px;
      background: linear-gradient(45deg, var(--secondary-color), var(--primary-color));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .logo img {
      height: 32px;
      border-radius: 8px;
    }

    .logo:hover {
      transform: scale(1.05);
    }

    /* Menu Button */
    .dropbtn {
      position: absolute;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-color);
      padding: 12px 16px;
      font-size: 20px;
      border: none;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .dropbtn:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-50%) scale(1.1);
    }

    /* Sidebar */
    .dropdown-content {
      height: 100vh;
      width: 280px;
      position: fixed;
      top: 0;
      left: -280px;
      background: rgba(0, 0, 0, 0.95);
      backdrop-filter: blur(20px);
      overflow-x: hidden;
      transition: left 0.4s ease, opacity 0.4s ease;
      z-index: 2000;
      padding-top: 0;
      opacity: 0;
      border-right: 1px solid var(--border-color);
    }

    .dropdown-content.show {
      left: 0;
      opacity: 1;
    }

    .sidebar-logo {
      color: var(--text-color);
      font-size: 22px;
      margin: 0;
      padding: 25px 20px;
      text-align: left;
      background: linear-gradient(45deg, var(--secondary-color), var(--primary-color));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-weight: bold;
      border-bottom: 1px solid var(--border-color);
    }

    .dropdown-content a {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 18px 25px;
      color: var(--text-color);
      text-decoration: none;
      transition: all 0.3s ease;
      border-left: 4px solid transparent;
    }

    .dropdown-content a i {
      width: 20px;
      text-align: center;
    }

    .dropdown-content a:hover {
      background: rgba(255, 255, 255, 0.1);
      border-left: 4px solid var(--primary-color);
      padding-left: 30px;
    }

    .dropdown-content a.active {
      background: rgba(254, 202, 87, 0.1);
      border-left: 4px solid var(--primary-color);
    }

    /* Main Content */
    .container {
      max-width: 1200px;
      margin: 40px auto;
      padding: 30px;
      background: var(--card-bg);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      border: 1px solid var(--border-color);
      opacity: 1;
      transform: translateY(0);
      transition: all 0.5s ease;
    }

    .container.hidden {
      opacity: 0;
      transform: translateY(20px);
    }

    /* Overlay */
    #overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, var(--dark-bg) 0%, var(--medium-bg) 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 3000;
      transition: opacity 0.5s ease;
    }

    #overlay.hide {
      opacity: 0;
      pointer-events: none;
    }

    .loading-text {
      margin-top: 20px;
      font-size: 18px;
      color: var(--primary-color);
    }

    .spinner {
      border: 4px solid rgba(255, 255, 255, 0.1);
      border-top: 4px solid var(--primary-color);
      border-radius: 50%;
      width: 60px;
      height: 60px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Buttons */
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
    }

    .btn-primary {
      background: linear-gradient(45deg, var(--secondary-color), var(--primary-color));
      color: #000;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(254, 202, 87, 0.3);
    }

    .btn-discord {
      background: #5865F2;
      color: white;
    }

    .btn-discord:hover {
      background: #4752c4;
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(88, 101, 242, 0.3);
    }

    /* Cards */
    .card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 24px;
      margin: 20px 0;
      border: 1px solid var(--border-color);
      transition: all 0.3s ease;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    .card h3 {
      color: var(--primary-color);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* Features Grid */
    .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin: 30px 0;
    }

    /* Event Status */
    .event-status {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      margin: 10px 0;
    }

    .status-indicator {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--success-color);
    }

    .status-indicator.inactive {
      background: var(--error-color);
    }

    /* Event Log */
    .event-log {
      max-height: 400px;
      overflow-y: auto;
      margin: 15px 0;
    }

    .event-item {
      background: rgba(255, 255, 255, 0.03);
      border-left: 4px solid var(--primary-color);
      padding: 12px 15px;
      margin: 8px 0;
      border-radius: 0 8px 8px 0;
    }

    .event-item.success {
      border-left-color: var(--success-color);
    }

    .event-item.error {
      border-left-color: var(--error-color);
    }

    .event-time {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 5px;
    }

    /* Server List */
    .server-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin: 15px 0;
    }

    .server-item {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 15px;
      font-family: 'Courier New', monospace;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .server-info {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .server-job {
      color: var(--primary-color);
      font-weight: bold;
    }

    .server-players {
      color: var(--success-color);
    }

    .server-wait {
      color: var(--secondary-color);
    }

    .server-actions {
      display: flex;
      gap: 10px;
    }

    .copy-btn {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.3s ease;
    }

    .copy-btn:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    /* Event Dropdown */
    .event-dropdown {
      margin: 20px 0;
    }

    .event-dropdown-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 1px solid var(--border-color);
    }

    .event-dropdown-header:hover {
      background: rgba(255, 255, 255, 0.08);
    }

    .event-dropdown-header.active {
      background: rgba(254, 202, 87, 0.1);
      border-color: var(--primary-color);
    }

    .event-dropdown-title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: bold;
      color: var(--primary-color);
    }

    .event-dropdown-count {
      background: rgba(255, 255, 255, 0.1);
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 12px;
    }

    .event-dropdown-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 0 0 8px 8px;
    }

    .event-dropdown-content.show {
      max-height: 500px;
    }

    .event-server-list {
      padding: 15px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .event-server-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 6px;
      border: 1px solid var(--border-color);
    }

    .event-server-info {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .event-server-job {
      color: var(--primary-color);
      font-weight: bold;
      font-family: 'Courier New', monospace;
    }

    .event-server-players {
      color: var(--success-color);
      font-size: 12px;
    }

    .event-server-time {
      color: var(--text-muted);
      font-size: 11px;
    }

    /* Footer */
    footer {
      text-align: center;
      padding: 30px;
      margin-top: 50px;
      border-top: 1px solid var(--border-color);
      background: rgba(0, 0, 0, 0.8);
    }

    /* Page Sections */
    .page-section {
      display: none;
    }

    .page-section.active {
      display: block;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .container {
        margin: 20px;
        padding: 20px;
      }
      
      .features-grid {
        grid-template-columns: 1fr;
      }
      
      .dropdown-content {
        width: 250px;
        left: -250px;
      }
      
      .server-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }
      
      .server-actions {
        align-self: flex-end;
      }
      
      .event-server-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
    }

    /* No JavaScript Warning */
    .no-js-warning {
      background: var(--error-color);
      color: white;
      padding: 15px;
      text-align: center;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 9999;
    }
  </style>
</head>
<body>

<div id="overlay">
  <div class="spinner"></div>
  <div class="loading-text">Đang tải Saki Hub...</div>
</div>

<noscript>
  <div class="no-js-warning">
    <p>⚠️ Trang web này yêu cầu JavaScript để hoạt động. Vui lòng bật JavaScript trong trình duyệt của bạn.</p>
  </div>
</noscript>

<header>
  <button class="dropbtn" id="menuBtn">
    <i class="fas fa-bars"></i>
  </button>
  <div class="logo" id="logo">
    <img src="logo.png" alt="Saki Hub Logo">
    Saki Hub
  </div>
</header>

<div class="dropdown-content" id="dropdownMenu">
  <div class="sidebar-logo">
    <i class="fas fa-cube"></i>
    Saki Hub
  </div>
  <a href="#" data-page="home" class="active">
    <i class="fas fa-home"></i>
    Trang Chủ
  </a>
  <a href="#" data-page="events">
    <i class="fas fa-calendar-alt"></i>
    Sự Kiện Game
  </a>
  <a href="#" data-page="servers">
    <i class="fas fa-server"></i>
    Servers
  </a>
  <a href="#" data-page="script">
    <i class="fas fa-code"></i>
    Script
  </a>
  <a href="#" data-page="connect">
    <i class="fas fa-users"></i>
    Kết Nối
  </a>
  <a href="#" data-page="api">
    <i class="fas fa-database"></i>
    API Documentation
  </a>
</div>

<div class="container" id="mainContent">
  <!-- Nội dung trang chủ mặc định -->
  <div id="home" class="page-section active">
    <h1><i class="fas fa-home"></i> Chào Mừng Đến Saki Hub</h1>
    <p>Hệ thống theo dõi sự kiện Blox Fruits tự động và thời gian thực</p>
    
    <div class="card">
      <h3><i class="fas fa-star"></i> Giới Thiệu</h3>
      <p>Saki Hub cung cấp giải pháp theo dõi sự kiện trong game Blox Fruits một cách tự động. Hệ thống sẽ thông báo ngay lập tức khi có sự kiện mới xuất hiện.</p>
    </div>

    <div class="features-grid">
      <div class="card">
        <h3><i class="fas fa-bolt"></i> Theo Dõi Thời Gian Thực</h3>
        <p>Nhận thông báo ngay lập tức khi sự kiện xuất hiện trong game</p>
      </div>
      <div class="card">
        <h3><i class="fas fa-robot"></i> Tự Động Hoàn Toàn</h3>
        <p>Không cần can thiệp thủ công, hệ thống tự động phát hiện sự kiện</p>
      </div>
      <div class="card">
        <h3><i class="fas fa-globe"></i> Đa Nền Tảng</h3>
        <p>Hoạt động trên cả Discord và website của bạn</p>
      </div>
    </div>

    <div class="card">
      <h3><i class="fas fa-chart-line"></i> Trạng Thái Sự Kiện</h3>
      <div style="text-align: center; padding: 20px;">
        <i class="fas fa-sync-alt" style="font-size: 48px; color: #feca57; margin-bottom: 15px;"></i>
        <p><strong>Đang chờ dữ liệu từ Roblox</strong></p>
        <p>Chạy script trong game để thấy trạng thái thực tế</p>
      </div>
    </div>

    <div class="card">
      <h3><i class="fas fa-plug"></i> Trạng thái hệ thống</h3>
      <p>API Base URL: <code id="api-url">https://saki-hub.vercel.app/api</code></p>
      <p><strong>✅ CHẾ ĐỘ DATA THẬT</strong> - Chỉ hiển thị dữ liệu từ Roblox</p>
      <div style="display: flex; gap: 10px; margin-top: 15px;">
        <button onclick="testAPI()" class="btn btn-primary">
          <i class="fas fa-test"></i> Test API
        </button>
      </div>
    </div>
  </div>

  <!-- Trang sự kiện -->
  <div id="events" class="page-section">
    <h1><i class="fas fa-calendar-alt"></i> Sự Kiện Blox Fruits - REAL TIME</h1>
    <p>Theo dõi tất cả sự kiện trong game theo thời gian thực</p>
    
    <div class="card">
      <h3><i class="fas fa-database"></i> Events từ Roblox</h3>
      <div class="event-log" id="realTimeEvents">
        <div class="event-item">
          <div><strong>🔄 Đang chờ dữ liệu...</strong></div>
          <div>Chạy script trong game Blox Fruits để thấy events thật</div>
        </div>
      </div>
      <div style="display: flex; gap: 10px; margin-top: 15px;">
        <button onclick="loadEvents()" class="btn btn-primary">
          <i class="fas fa-sync-alt"></i> Refresh Events
        </button>
        <button onclick="testAPI()" class="btn" style="background: #666;">
          <i class="fas fa-test"></i> Test API
        </button>
      </div>
    </div>

    <div class="card">
      <h3><i class="fas fa-terminal"></i> API Log</h3>
      <div class="event-log" id="eventsLog">
        <p>Chưa có activity nào</p>
      </div>
    </div>
    
    <div class="features-grid" id="eventsGrid">
      <!-- Events sẽ được thêm vào đây bằng JavaScript -->
    </div>
  </div>
  
  <!-- Trang servers -->
  <div id="servers" class="page-section">
    <h1><i class="fas fa-server"></i> Active Servers</h1>
    <p>Danh sách các server đang có sự kiện Blox Fruits</p>
    
    <div class="card">
      <h3><i class="fas fa-list"></i> Server List theo Sự Kiện</h3>
      <div id="eventDropdowns">
        <div class="event-item">
          <div><strong>🔄 Đang tải dữ liệu...</strong></div>
          <div>Chạy script Roblox để thấy servers thật</div>
        </div>
      </div>
      <div style="display: flex; gap: 10px; margin-top: 15px;">
        <button onclick="loadAllEventServers()" class="btn btn-primary">
          <i class="fas fa-sync-alt"></i> Refresh All Servers
        </button>
      </div>
    </div>

    <div class="card">
      <h3><i class="fas fa-info-circle"></i> Hướng dẫn</h3>
      <p>• Click vào tên sự kiện để mở/rút gọn danh sách server</p>
      <p>• Click "Copy" để copy Job ID của server</p>
      <p>• Sử dụng Job ID để join server thông qua script</p>
      <p>• Players: Hiển thị số người chơi hiện tại trong server</p>
      <p><strong>📢 Hiện chỉ hiển thị DATA THẬT từ Roblox</strong></p>
    </div>
  </div>
  
  <!-- Các trang khác -->
  <div id="script" class="page-section">
    <!-- Nội dung trang script -->
  </div>
  
  <div id="connect" class="page-section">
    <!-- Nội dung trang kết nối -->
  </div>
  
  <div id="api" class="page-section">
    <!-- Nội dung trang API -->
  </div>
</div>

<footer>
  <p>&copy; 2024 Saki Hub. All rights reserved.</p>
  <p>Blox Fruits Event Tracking System</p>
</footer>

<script>
  // Khởi tạo biến và hàm toàn cục
  const overlay = document.getElementById('overlay');
  const menuBtn = document.getElementById('menuBtn');
  const dropdownMenu = document.getElementById('dropdownMenu');
  const mainContent = document.getElementById('mainContent');
  const logo = document.getElementById('logo');
  const pageSections = document.querySelectorAll('.page-section');

  // API Configuration
  const API_BASE_URL = 'https://saki-hub.vercel.app/api';
  let eventsLog = [];
  let activeServers = [];
  let eventsDatabase = [];

  // Danh sách sự kiện Blox Fruits với API endpoints riêng
  const eventsList = [
    { 
      name: "Full Moon", 
      world: "World 3", 
      active: false, 
      color: "#4CAF50", 
      icon: "fas fa-moon",
      endpoint: "/fullmoon"
    },
    { 
      name: "Near Full Moon", 
      world: "World 3", 
      active: false, 
      color: "#FF9800", 
      icon: "fas fa-moon",
      endpoint: "/nearfullmoon"
    },
    { 
      name: "Mystic Island", 
      world: "World 3", 
      active: false, 
      color: "#2196F3", 
      icon: "fas fa-mountain",
      endpoint: "/mysticisland"
    },
    { 
      name: "Rip Indra True Form", 
      world: "World 3", 
      active: false, 
      color: "#F44336", 
      icon: "fas fa-skull",
      endpoint: "/ripindra"
    },
    { 
      name: "Dough King", 
      world: "World 3", 
      active: false, 
      color: "#9C27B0", 
      icon: "fas fa-crown",
      endpoint: "/doughking"
    },
    { 
      name: "Darkbeard", 
      world: "World 2", 
      active: false, 
      color: "#607D8B", 
      icon: "fas fa-skull-crossbones",
      endpoint: "/darkbeard"
    },
    { 
      name: "Cursed Captain", 
      world: "World 2", 
      active: false, 
      color: "#795548", 
      icon: "fas fa-ghost",
      endpoint: "/cursedcaptain"
    }
  ];

  // Cập nhật URL API trong giao diện
  document.getElementById('api-url').textContent = API_BASE_URL;

  // Hàm khởi tạo
  function init() {
    setTimeout(() => {
      overlay.classList.add('hide');
      setTimeout(() => overlay.style.display = 'none', 500);
    }, 1500);

    setupMenuEvents();
    setupPageNavigation();
    loadInitialData();
    createEventsGrid();
  }

  // Tạo grid sự kiện
  function createEventsGrid() {
    const eventsGrid = document.getElementById('eventsGrid');
    if (!eventsGrid) return;
    
    eventsGrid.innerHTML = eventsList.map(event => `
      <div class="card">
        <h3 style="color: ${event.color}">
          <i class="${event.icon}"></i>
          ${event.name}
        </h3>
        <p><strong>Thế giới:</strong> ${event.world}</p>
        <p><strong>API Endpoint:</strong> <code>${API_BASE_URL}${event.endpoint}</code></p>
        <p><strong>Trạng thái:</strong> 
          <span style="color: #888">
            Chờ dữ liệu thực tế
          </span>
        </p>
        <div class="event-status">
          <div class="status-indicator inactive"></div>
          <span>Chưa phát hiện</span>
        </div>
      </div>
    `).join('');
  }

  // Thiết lập sự kiện cho menu
  function setupMenuEvents() {
    menuBtn.addEventListener('click', () => {
      dropdownMenu.classList.toggle('show');
    });

    window.addEventListener('click', (e) => {
      if (!menuBtn.contains(e.target) && !dropdownMenu.contains(e.target)) {
        dropdownMenu.classList.remove('show');
      }
    });
  }

  // Thiết lập sự kiện cho điều hướng trang
  function setupPageNavigation() {
    const links = dropdownMenu.querySelectorAll('a');
    links.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const page = link.getAttribute('data-page');
        showPage(page);
        dropdownMenu.classList.remove('show');
      });
    });

    logo.addEventListener('click', () => {
      showPage('home');
    });
  }

  // Hiển thị trang được chọn
  function showPage(page) {
    pageSections.forEach(section => {
      section.classList.remove('active');
    });
    
    const targetPage = document.getElementById(page);
    if (targetPage) {
      targetPage.classList.add('active');
      updateActiveNav(page);
      localStorage.setItem("currentPage", page);
      
      const url = new URL(window.location);
      url.searchParams.set('page', page);
      window.history.replaceState({}, '', url);
      
      loadPageData(page);
    }
  }

  // Cập nhật điều hướng active
  function updateActiveNav(page) {
    const links = dropdownMenu.querySelectorAll('a');
    links.forEach(link => {
      link.classList.remove('active');
      if (link.getAttribute('data-page') === page) {
        link.classList.add('active');
      }
    });
  }

  // Tải dữ liệu ban đầu
  function loadInitialData() {
    const savedPage = localStorage.getItem("currentPage") || "home";
    const urlPage = new URLSearchParams(window.location.search).get("page");
    const pageToShow = urlPage || savedPage;
    showPage(pageToShow);
  }

  // Tải dữ liệu cho trang cụ thể
  function loadPageData(page) {
    switch(page) {
      case 'events':
        loadEvents();
        break;
      case 'servers':
        loadAllEventServers();
        break;
    }
  }

  // Hàm gọi API
  async function callAPI(endpoint, method = 'GET', data = null) {
    try {
      const options = {
        method: method,
        headers: {
          'Content-Type': 'application/json',
        }
      };

      if (data && (method === 'POST' || method === 'PUT')) {
        options.body = JSON.stringify(data);
      }

      const response = await fetch(`${API_BASE_URL}${endpoint}`, options);
      const result = await response.json();
      
      addToLog(`${method} ${endpoint}`, result.success ? 'success' : 'error', result);
      
      return result;
    } catch (error) {
      console.error('API Error:', error);
      addToLog(`${method} ${endpoint}`, 'error', { error: error.message });
      return { success: false, error: error.message };
    }
  }

  // Hàm thêm vào log
  function addToLog(action, type, data) {
    const logItem = {
      id: Date.now(),
      action,
      type,
      data,
      timestamp: new Date().toLocaleString('vi-VN')
    };
    
    eventsLog.unshift(logItem);
    if (eventsLog.length > 50) eventsLog = eventsLog.slice(0, 50);
    
    if (document.getElementById('eventsLog')) {
      updateEventsLog();
    }
  }

  // Hàm cập nhật log UI
  function updateEventsLog() {
    const logContainer = document.getElementById('eventsLog');
    if (!logContainer) return;

    logContainer.innerHTML = eventsLog.map(item => `
      <div class="event-item ${item.type}">
        <div><strong>${item.action}</strong> - ${item.type === 'success' ? '✅' : '❌'}</div>
        <div>${JSON.stringify(item.data)}</div>
        <div class="event-time">${item.timestamp}</div>
      </div>
    `).join('');
  }

  // Hàm test API
  async function testAPI() {
    const testData = {
      event_type: "test_event",
      boss_name: "Test Boss",
      players: "5/10",
      job_id: "test_" + Date.now(),
      world: "World3",
      timestamp: new Date().toISOString()
    };

    const result = await callAPI('/events', 'POST', testData);
    
    if (result.success) {
      alert('✅ Test API thành công! Data đã được lưu.');
      loadEvents();
      loadAllEventServers();
    } else {
      alert('❌ Test API thất bại: ' + (result.error || 'Unknown error'));
    }
  }

  // Hàm load events từ API
  async function loadEvents() {
    const result = await callAPI('/events', 'GET');
    
    if (result.success && result.events) {
      eventsDatabase = result.events;
      const eventsContainer = document.getElementById('realTimeEvents');
      if (eventsContainer) {
        if (result.events.length === 0) {
          eventsContainer.innerHTML = `
            <div class="event-item">
              <div><strong>🔄 Đang chờ dữ liệu từ Roblox</strong></div>
              <div>Chạy script trong game để thấy events thật</div>
            </div>
          `;
        } else {
          eventsContainer.innerHTML = result.events.map(event => `
            <div class="event-item success">
              <div><strong>${event.boss_name || event.event_type}</strong></div>
              <div>Server: ${event.job_id || 'N/A'} | Players: ${event.players || 'N/A'}</div>
              <div>World: ${event.world || 'N/A'} | Time: ${event.time_of_day || 'N/A'}</div>
              <div class="event-time">${new Date(event.received_at).toLocaleString('vi-VN')}</div>
            </div>
          `).join('');
        }
      }
    }
  }

  // Hàm load tất cả server theo sự kiện
  async function loadAllEventServers() {
    const dropdownsContainer = document.getElementById('eventDropdowns');
    if (!dropdownsContainer) return;

    dropdownsContainer.innerHTML = `
      <div class="event-item">
        <div><strong>🔄 Đang tải dữ liệu từ các API...</strong></div>
      </div>
    `;

    let allServers = [];

    // Gọi tất cả API endpoints
    for (const event of eventsList) {
      try {
        const result = await callAPI(event.endpoint, 'GET');
        
        if (result.success && result.servers) {
          allServers = allServers.concat(result.servers.map(server => ({
            ...server,
            event_type: event.name,
            event_icon: event.icon,
            event_color: event.color
          })));
        }
      } catch (error) {
        console.error(`Lỗi khi tải ${event.name}:`, error);
      }
    }

    // Hiển thị kết quả
    if (allServers.length === 0) {
      dropdownsContainer.innerHTML = `
        <div class="event-item">
          <div><strong>📭 Không có server nào đang có sự kiện</strong></div>
          <div>Chạy script Roblox để thấy servers thật</div>
        </div>
      `;
    } else {
      // Nhóm server theo sự kiện
      const groupedServers = groupServersByEvent(allServers);
      displayEventDropdowns(groupedServers);
    }
  }

  // Nhóm server theo sự kiện
  function groupServersByEvent(servers) {
    const grouped = {};
    
    servers.forEach(server => {
      const eventName = server.event_type;
      if (!grouped[eventName]) {
        grouped[eventName] = {
          event: eventsList.find(e => e.name === eventName),
          servers: []
        };
      }
      grouped[eventName].servers.push(server);
    });
    
    return grouped;
  }

  // Hiển thị dropdown cho từng sự kiện
  function displayEventDropdowns(groupedServers) {
    const dropdownsContainer = document.getElementById('eventDropdowns');
    
    dropdownsContainer.innerHTML = Object.entries(groupedServers).map(([eventName, data]) => {
      const event = data.event;
      const servers = data.servers;
      
      return `
        <div class="event-dropdown">
          <div class="event-dropdown-header" onclick="toggleDropdown(this)">
            <div class="event-dropdown-title">
              <i class="${event.icon}" style="color: ${event.color}"></i>
              ${eventName}
            </div>
            <div class="event-dropdown-count">${servers.length} server(s)</div>
          </div>
          <div class="event-dropdown-content">
            <div class="event-server-list">
              ${servers.map(server => `
                <div class="event-server-item">
                  <div class="event-server-info">
                    <div class="event-server-job">${server.job_id}</div>
                    <div class="event-server-players">Players: ${server.players}</div>
                    <div class="event-server-time">Cập nhật: ${new Date(server.timestamp).toLocaleString('vi-VN')}</div>
                  </div>
                  <div class="server-actions">
                    <button class="copy-btn" onclick="copyJobId('${server.job_id}')">
                      <i class="fas fa-copy"></i> Copy
                    </button>
                  </div>
                </div>
              `).join('')}
            </div>
          </div>
        </div>
      `;
    }).join('');
  }

  // Toggle dropdown
  function toggleDropdown(header) {
    const content = header.nextElementSibling;
    const isActive = header.classList.contains('active');
    
    // Đóng tất cả dropdown khác
    document.querySelectorAll('.event-dropdown-header').forEach(h => {
      h.classList.remove('active');
      h.nextElementSibling.classList.remove('show');
    });
    
    // Mở dropdown hiện tại nếu chưa active
    if (!isActive) {
      header.classList.add('active');
      content.classList.add('show');
    }
  }

  // Hàm copy Job ID
  function copyJobId(jobId) {
    navigator.clipboard.writeText(jobId).then(() => {
      alert(`Đã copy Job ID: ${jobId}`);
    }).catch(err => {
      console.error('Lỗi copy: ', err);
    });
  }

  // Khởi chạy ứng dụng
  document.addEventListener('DOMContentLoaded', init);

  // Tự động refresh data mỗi 30 giây
  setInterval(() => {
    const currentPage = localStorage.getItem("currentPage") || "home";
    if (currentPage === 'events') {
      loadEvents();
    } else if (currentPage === 'servers') {
      loadAllEventServers();
    }
  }, 30000);

  console.log("✅ Saki Hub - Hệ thống API riêng cho từng sự kiện");
</script>
</body>
</html>
